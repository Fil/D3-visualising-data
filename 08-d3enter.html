<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>Software Carpentry: D3 - Faites entrer les données</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="alternate" type="application/rss+xml" title="Software Carpentry Blog" href="http://software-carpentry.org/feed.xml"/>
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="http://software-carpentry.org" title="Software Carpentry">
          <img alt="Software Carpentry banner" src="img/software-carpentry-banner.png" />
        </a>
      </div>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
          <h1 class="title">D3 - Faites entrer les données</h1>
          <h2 class="subtitle">Enfin du dessin !</h2>
<div id="objectifs-de-la-leçon" class="objectives panel panel-warning">
<div class="panel-heading">
<h2 id="objectifs-de-la-leçon" class="objectives panel panel-warning"><span class="glyphicon glyphicon-certificate"></span>Objectifs de la leçon</h2>
</div>
<div class="panel-body">
<ul>
<li>Créer les axes</li>
<li>Afficher des données (d3.enter)</li>
</ul>
</div>
</div>
<p>On veut construire nos axes à partir des données. Cela signifie qu’il faut d’abord connaître les valeurs minimum et maximum de nos données, et décider quel type d’axe nous voulons (linéaire ou logarithmique, par exemple).</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="co">// Créer une échelle logarithmique pour le revenu</span>
<span class="kw">var</span> xScale <span class="op">=</span> <span class="va">d3</span>.<span class="va">scale</span>.<span class="at">log</span>()<span class="op">;</span> <span class="co">// revenu</span>
<span class="va">xScale</span>.<span class="at">domain</span>([<span class="dv">250</span><span class="op">,</span> <span class="fl">1e5</span>])<span class="op">;</span> <span class="co">// valeurs minimum et maximum</span>
<span class="va">xScale</span>.<span class="at">range</span>([<span class="dv">0</span><span class="op">,</span> canvas_width])<span class="op">;</span> <span class="co">// emplacement minimum et maximum sur la page</span></code></pre></div>
<p>L’objet scale de D3 fournit un grand nombre de fonctions permettant de créer des échelles de façon pratique et logique. Par exemple, on peut choisir la progression de l’échelle, qu’elle soit logarithmique (<code>log</code>), linéaire (<code>linear</code>), en racine carrée (<code>sqrt</code>), ou encore catégorique (l’échelle <code>category20</code> peut représenter 20 classes de données par 20 couleurs différentes).</p>
<p>Le <code>domain</code> correspond aux valeurs des données qui seront converties en positions sur la page; les positions sont spécifiées par le <code>range</code>. Souvent, le domaine est réglé sur les valeurs minimum et maximum des données, et le range sur les bords de la zone de tracé du graphique.</p>
<p>Mais ce n’est pas obligatoirement le cas. Pensons par exemple à un zoom sur une partie des données : on changerait alors le domaine, sans toucher au range.</p>
<p>Le fonctionnement des objets de d3 permet d’avoir une notation plus lisible, sur une seule ligne, avec le même résultat:</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">var</span> xScale <span class="op">=</span> <span class="va">d3</span>.<span class="va">scale</span>.<span class="at">log</span>().<span class="at">domain</span>([<span class="dv">300</span><span class="op">,</span> <span class="fl">1e5</span>]).<span class="at">range</span>([<span class="dv">0</span><span class="op">,</span> canvas_width])<span class="op">;</span>  </code></pre></div>
<p>Ces deux manières d’écrire du code sont parfaitement interchangeables et c’est à vous d’utiliser celle qui vous paraît la plus intuitive.</p>
<p>L’étape suivante est la création des axes, en les reliant à l’échelle que nous venons de créer:</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="co">// Creating the x &amp; y axes.</span>
<span class="kw">var</span> xAxis <span class="op">=</span> <span class="va">d3</span>.<span class="va">svg</span>.<span class="at">axis</span>().<span class="at">orient</span>(<span class="st">&quot;bottom&quot;</span>).<span class="at">scale</span>(xScale)<span class="op">;</span></code></pre></div>
<p><code>orient()</code> définit l’orientation de l’axe et la position des marques. Il restera à positionner l’axe sur le cadre.</p>
<p>Jusqu’ici, l’axe défini ne s’affiche pas sur la page. Pour le pousser sur notre fonds, il faut créer un élément g (avec <code>.append</code>).</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="co">// Ajouter l&#39;axe des x.</span>
<span class="va">canvas</span>.<span class="at">append</span>(<span class="st">&quot;g&quot;</span>)
    .<span class="at">attr</span>(<span class="st">&quot;class&quot;</span><span class="op">,</span> <span class="st">&quot;x axis&quot;</span>)
  .<span class="at">attr</span>(<span class="st">&quot;transform&quot;</span><span class="op">,</span> <span class="st">&quot;translate(0,&quot;</span> <span class="op">+</span> canvas_height <span class="op">+</span> <span class="st">&quot;)&quot;</span>)
  .<span class="at">call</span>(xAxis)<span class="op">;</span></code></pre></div>
<p><code>.call</code> appelle l’axe que nous venons de créer et le pousse sur l’élément g. On ajoute un attribut transform, qui permet de déplacer l’axe vers le bas du graphique (plutôt qu’il ne reste tout en haut à la position y=0). L’attribut transform a beaucoup d’options possibles (mise à l’échelle, rotation…), mais ici nous utilisons seulement la translation (<code>translate</code>), avec les valeurs dans les directions x et y. Ici on le déplace uniquement vers le bas, dans la direction y, sur la hauteur de notre graphique. On lui donne également une classe, juste pour le cas où nous voudrons par la suite le sélectionner dans notre code.</p>
<div id="nous-aurons-aussi-besoin-dun-axe-des-y" class="challenge panel panel-success">
<div class="panel-heading">
<h1 id="nous-aurons-aussi-besoin-dun-axe-des-y" class="challenge panel panel-success"><span class="glyphicon glyphicon-pencil"></span>Nous aurons aussi besoin d’un axe des y</h1>
</div>
<div class="panel-body">
<ol style="list-style-type: decimal">
<li>Créer une échelle linéaire pour l’axe des y, avec un minimum de 10 et un maximum de 85. Puis ajouter l’axe au fonds SVG.</li>
</ol>
</div>
</div>
<p>On commence à se rapprocher. Avec nos deux axes, on peut maintenant ajouter nos données.</p>
<p>Nous allons ajouter un cercle par point de données! Mais on ne veut pas voir toutes les données, on va d’abord se limiter aux données les plus récentes, les chiffres de l’année 2009.</p>
<p><img src="img/data_structure.png" alt="data structure" width="500" /></p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">var</span> data_canvas <span class="op">=</span> <span class="va">canvas</span>.<span class="at">append</span>(<span class="st">&quot;g&quot;</span>)
  .<span class="at">attr</span>(<span class="st">&quot;class&quot;</span><span class="op">,</span> <span class="st">&quot;data_canvas&quot;</span>)<span class="op">;</span>
      
<span class="kw">var</span> dot <span class="op">=</span> <span class="va">data_canvas</span>.<span class="at">selectAll</span>(<span class="st">&quot;.dot&quot;</span>)
  .<span class="at">data</span>(nations<span class="op">,</span> <span class="kw">function</span>(d)<span class="op">{</span><span class="cf">return</span> <span class="va">d</span>.<span class="at">name</span><span class="op">}</span>)<span class="op">;</span>

<span class="va">dot</span>.<span class="at">enter</span>().<span class="at">append</span>(<span class="st">&quot;circle&quot;</span>).<span class="at">attr</span>(<span class="st">&quot;class&quot;</span><span class="op">,</span><span class="st">&quot;dot&quot;</span>)
  .<span class="at">attr</span>(<span class="st">&quot;cx&quot;</span><span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> <span class="at">xScale</span>(<span class="va">d</span>.<span class="at">income</span>[<span class="va">d</span>.<span class="va">income</span>.<span class="at">length</span><span class="dv">-1</span>])<span class="op">;</span> <span class="op">}</span>) 
  .<span class="at">attr</span>(<span class="st">&quot;cy&quot;</span><span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> <span class="at">yScale</span>(<span class="va">d</span>.<span class="at">lifeExpectancy</span>[<span class="va">d</span>.<span class="va">lifeExpectancy</span>.<span class="at">length</span><span class="dv">-1</span>])<span class="op">;</span> <span class="op">}</span>)
  .<span class="at">attr</span>(<span class="st">&quot;r&quot;</span><span class="op">,</span> <span class="dv">5</span>)<span class="op">;</span></code></pre></div>
<p>On commence donc par ajouter un élément <code>g</code> à notre fonds. Ce groupe sera l’emplacement où viendront se positionner les données, on lui donne une classe portant ce nom <code>data_canvas</code>. On sélectionne alors tous les éléments de la classe <code>dot</code>. Cette sélection est vide, pour le moment. Puis nous indiquons à notre page dans quelle variable se trouvent les données, en utilisant <code>.data(nations)</code>.</p>
<p>On emploie ici une fonction de clé <code>.data(nations, function(d){return d.name});</code>. Cette fonction permettra à D3 de suivre les données quand on commencera à les modifier: chaque cercle tracé correspondant à un pays, on l’associé avec cette clé. Il faut absolument que cette clé soit unique.</p>
<p>Et c’est ici qu’opère la magie: La fonction <code>enter()</code> prend chaque élément du jeu de données, et applique tout ce qui suit à chacun des éléments que l’on a ajoutés. Ces nouveaux points vont être ajoutés avec la classe 'dot', ce qui permettra de les récupérer au prochain appel de <code>data_canvas.selectAll(&quot;.dot&quot;)</code>.</p>
<p>Maintenant nous allons créer un cercle pour chaque point de données. C’est le rôle des quatre lignes de code qui suivent. Elles créent le cercle, puis règlent ses attributs <code>cx</code>, <code>cy</code>, et <code>r</code>. Les attributs <code>cx</code> et <code>cy</code> définissent la position du centre du cercle et sont basés sur le revenu (on utilise la donnée la plus récente avec le code: <code>[nation.income.length-1]</code>.) et l’espérance de vie, que l’on trouve dans notre donnée (temporairement appelée <code>d</code>). Le rayon pour l’instant est fixée à une valeur arbitraire.</p>
<div id="une-dimension-supplémentaire" class="challenge panel panel-success">
<div class="panel-heading">
<h1 id="une-dimension-supplémentaire" class="challenge panel panel-success"><span class="glyphicon glyphicon-pencil"></span>Une dimension supplémentaire</h1>
</div>
<div class="panel-body">
<p>Modifier le code de façon à ce que le rayon des cercles représente la population. Pour cela il faudra créer une échelle 'sqrt' avec un minimum égal à 0 et un maximum de 5e8. Le range devrait aller de 0 à 40 pixels.</p>
</div>
</div>
<iframe src="http://isakiko.github.io/D3-visualising-data/code/index08.html" width="1000" height="600">
</iframe>
        </div>
      </div>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
        <a class="label swc-blue-bg" href="https://github.com/swcarpentry/lesson-template">Source</a>
        <a class="label swc-blue-bg" href="mailto:admin@software-carpentry.org">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="http://software-carpentry.org/v5/js/jquery-1.9.1.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
  </body>
</html>
