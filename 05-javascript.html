<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>Software Carpentry: Javascript</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="alternate" type="application/rss+xml" title="Software Carpentry Blog" href="http://software-carpentry.org/feed.xml"/>
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="http://software-carpentry.org" title="Software Carpentry">
          <img alt="Software Carpentry banner" src="img/software-carpentry-banner.png" />
        </a>
      </div>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
          <h1 class="title">Javascript</h1>
          <h2 class="subtitle">Nourrir un chat</h2>
<div id="objectifs-de-la-leçon" class="objectives panel panel-warning">
<div class="panel-heading">
<h2 id="objectifs-de-la-leçon" class="objectives panel panel-warning"><span class="glyphicon glyphicon-certificate"></span>Objectifs de la leçon</h2>
</div>
<div class="panel-body">
<ul>
<li>Charger un fichier Javascript</li>
<li>Passer des éléments HTML à Javascript</li>
<li>Manipuler des éléments HTML avec Javascript</li>
</ul>
</div>
</div>
Nous avons appris à intégrer du texte et des éléments graphiques dans notre page, et nous avons aussi appris à publier cette page. Jusqu’ici, rien de ce que nous avons fait n’est spécifique à la visualisation de données. Nous pourrions très bien créer notre graphique dans un autre logiciel, l’exporter sous la forme d’une image, et le publier comme cela. Mais cette approche ne nous permettra pas d’aller plus loin : comment permettre à l’utilisateur d’interagir avec les données ? Pour cela, il va falloir apprendre à écrire des scripts. À nouveau, HTML fournit la solution en permettant d’entrer des scripts. Tout ce qui est défini entre les balises &lt;script&gt; et &lt;/script&gt; dans l’entête ou le corps de la page est interprété comme du code Javascript. Puisque le code est exécuté au moment où il apparaît dans la page, il faut s’assurer que les éléments auxquels on va faire référence existent déjà. La manière la plus simple de procéder est d’écrire les scripts vers le bas de la page, juste avant la balise
</body>
<p>fermante. Comme nous l’avons fait avec les styles, nous pouvons exporter notre code dans un fichier externe, cette fois-ci avec l’extension <code>.js</code>.</p>
<p>Revenons maintenant à notre image de chat. Nous allons lui demander de miauler quand l’utilisateur le caresse avec le bout de sa souris. Il faut tout d’abord créer le fichier <code>interaction.js</code> , et l’appeler dans le corps du fichier HTML.</p>
<div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;interaction.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></code></pre></div>
<p>Pour que le script puisse fonctionner avec la page HTML, nous avons quatre étapes à formuler:</p>
<ul>
<li>Créer un lien entre le HTML et le script — par exemple en donnant un identifiant unique à l’image avec laquelle nous voulons interagir.</li>
<li>Récupérer l’élément en question, et le mémoriser dans une variable du script, pour pouvoir travailler dessus.</li>
<li>Détecter l’action qui nous intéresse — c’est-à-dire le clic de souris, en utilisant un « event listener ».</li>
<li>Réaliser une action.</li>
</ul>
<p>L’identifiant (ID) est un attribut unique que l’on peut donner à l’image sous cette forme:</p>
<div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&#39;image&#39;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;img</span><span class="ot"> id=</span><span class="st">&quot;cat&quot;</span><span class="ot"> src=</span><span class="st">&quot;img/cat.jpg&quot;</span><span class="kw">&gt;</span>
<span class="kw">&lt;/div&gt;</span></code></pre></div>
<p>La fonction Javascript <code>getElementById</code> nous permet de récupérer cet élément depuis le <code>document</code> (un objet magique qui représente la page entière), et le mémoriser dans une variable pour travailler ensuite avec depuis le fichier Javascript.</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">var</span> cat_image <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;cat&#39;</span>)<span class="op">;</span></code></pre></div>
<p>Nous voulons maintenant détecter si quelqu’un a cliqué sur l’image du chat. Les « listeners » nous aident en nous indiquant les événements réalisés par les humains sur notre page.</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">var</span> cat_image <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;cat&#39;</span>)<span class="op">;</span>
<span class="va">cat_image</span>.<span class="at">addEventListener</span>(<span class="st">&quot;click&quot;</span><span class="op">,</span> meow)<span class="op">;</span></code></pre></div>
<p>Notre listener prend deux arguments: le type d’événement que l’on va écouter, et une fonction dite « callback », qui sera appelée lorsque l’événement se produira. Cette fonction, nous l’appelons <code>meow()</code> (miaou), elle ouvrira une fenêtre pop-up. Pour cela nous pouvons utiliser la fonction Javascript alert().</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">function</span> <span class="at">meow</span>() <span class="op">{</span>
    <span class="at">alert</span>(<span class="st">&quot;Miaou!&quot;</span>)<span class="op">;</span>
<span class="op">};</span></code></pre></div>
<p>On peut aussi définir une fonction directement dans le listener, par exemple dans le cas où l’on veut exécuter une série d’opérations spécifiques à cet endroit. Ainsi par exemple la construction suivante va appeler la fonction <code>meow()</code>, mais aussi d’autres fonctions, comme <code>purr()</code> (ronronner… laquelle n’existe pas encore).</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">var</span> cat_image <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;cat&#39;</span>)<span class="op">;</span>
<span class="va">cat_image</span>.<span class="at">addEventListener</span>(<span class="st">&quot;click&quot;</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span>
    <span class="at">meow</span>()<span class="op">;</span> 
    <span class="at">purr</span>()<span class="op">;</span>
<span class="op">}</span>)<span class="op">;</span></code></pre></div>
<p>On peut aussi tout à fait se passer de nommer les fonctions de callback, et les définir de façon entièrement anonyme:</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">var</span> cat_image <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;cat&#39;</span>)<span class="op">;</span>
<span class="va">cat_image</span>.<span class="at">addEventListener</span>(<span class="st">&quot;click&quot;</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span>
    <span class="at">alert</span>(<span class="st">&quot;Meow!&quot;</span>)<span class="op">;</span> 
    <span class="at">purr</span>()<span class="op">;</span>
<span class="op">}</span>)<span class="op">;</span></code></pre></div>
<div id="débuguer-dans-le-navigateur" class="callout panel panel-info">
<div class="panel-heading">
<h2 id="débuguer-dans-le-navigateur" class="callout panel panel-info"><span class="glyphicon glyphicon-pushpin"></span>Débuguer dans le navigateur</h2>
</div>
<div class="panel-body">
<p>Si l’on fait un clic-droit sur la page pour ouvrir l’inspecteur, on revient aux outils développeurs. Parmi les onglets présents se trouvent:</p>
<ul>
<li>Console - La console nous prévient des erreurs. Elle permet aussi à notre code d’envoyer des messages, et d’afficher le contenu d’une variable <code>x</code>, en utilisant l’instruction <code>console.log(x)</code>.</li>
<li>Elements - Permet de vérifier si tous nos éléments HTML sont au bon endroit. En survolant n’importe quelle région de la page, on voit se surligner les éléments correspondants et on peut vérifier quels styles et attributs leur sont appliqués — et même modifier temporairement ces attributs, pour faire des essais « en direct ».</li>
<li>Sources - Ceci nous donne accès à l’ensemble des fichiers qui définissent notre page. Pour les fichiers Javascript, on peut même positionner des <em>breakpoints</em> pour mettre en pause l’exécution des scripts et observer l’état des variables.</li>
</ul>
</div>
</div>
<div id="nourrir-votre-chat" class="challenge panel panel-success">
<div class="panel-heading">
<h2 id="nourrir-votre-chat" class="challenge panel panel-success"><span class="glyphicon glyphicon-pencil"></span>Nourrir votre chat</h2>
</div>
<div class="panel-body">
<p>Créer un bouton en utilisant l’élément &lt;button&gt;; le bouton permettra de nourrir le chat en utilisant les éléments définis plus haut. Utiliser la fonction alert() pour que le chat vous remercie.</p>
</div>
</div>
<p>L’étape suivante pour une page totalement interactive, consiste à modifier les éléments HTML en utilisant Javascript. Nous avons créé un bouton dans le HTML, et ce bouton appelle une fonction quand il est cliqué.</p>
<p>Le but maintenant est que le chat grossisse un peu à chaque fois qu’il est nourri. Pour cela il faut mémoriser à la fois le bouton et le chat.</p>
<p>Pour fixer la largeur de l’image, on va écrire ces mots, en les reliant par des points: 'cat_image.style.width'. Il faut penser que la variable 'cat_image' est un objet possédant un attribut style, lequel à son tour a un attribut 'width'. Ajoutons quelques grammes à notre chat. Il nous faut d’abord récupérer la largeur courante de l’objet. Comme on peut le voir dans l’inspecteur, notre objet 'cat_image' a un attribut 'offsetWidth'. Ceci nous donne sa largeur courante sous forme d’un nombre (et non pas d’une chaîne '200px'). On va calculer la nouvelle valeur, et lui ajouter 'px’, puis l’indiquer dans le style de notre image.</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">var</span> cat_image <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;cat&#39;</span>)<span class="op">;</span>
<span class="kw">var</span> feed_button <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;button1&#39;</span>)<span class="op">;</span>

<span class="va">button1</span>.<span class="at">addEventListener</span>(<span class="st">&quot;click&quot;</span><span class="op">,</span> nourrir_le_chat)<span class="op">;</span>
<span class="kw">function</span> <span class="at">nourrir_le_chat</span>() <span class="op">{</span>
    <span class="va">cat_image</span>.<span class="va">style</span>.<span class="at">width</span> <span class="op">=</span> (<span class="va">cat_image</span>.<span class="at">offsetWidth</span> <span class="op">+</span> <span class="fl">30.0</span>) <span class="op">+</span> <span class="st">&#39;px&#39;</span><span class="op">;</span>
<span class="op">};</span></code></pre></div>
<p>On peut aussi passer un argument à la fonction <code>nourrir_le_chat</code> en l’inscrivant dans les parenthèses. Par exemple, l’utilisateur pourrait chisir quelle portion de nourriture il donne à son chat.</p>
<p>Il faudrait alors renvoyer une valeur et l’assigner à une variable (tout comme on a fait avec n’importe quelle autre fonction, par exemple <code>var element = document.getElementById(&quot;someID&quot;);</code>):</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">var</span> new_width <span class="op">=</span> <span class="at">feed</span>(<span class="dv">10</span>)<span class="op">;</span>

<span class="kw">function</span> <span class="at">feed</span>(mealsize) <span class="op">{</span>
        <span class="va">cat_image</span>.<span class="va">style</span>.<span class="at">width</span> <span class="op">=</span> (<span class="va">cat_image</span>.<span class="at">offsetWidth</span> <span class="op">+</span> <span class="at">parseInt</span>(mealsize)) <span class="op">+</span> <span class="st">&#39;px&#39;</span><span class="op">;</span>
        <span class="cf">return</span> <span class="va">cat_image</span>.<span class="va">style</span>.<span class="at">width</span><span class="op">;</span>
<span class="op">};</span></code></pre></div>
<p>En Javascript il y a deux grands types de données: les chaînes de caractères (texte, tout entre guillemets) et les nombres. Il est important de se souvenir qu’on ne peut pas faire de calculs avec des chaînes.</p>
<p>Par exemple: <code>5+5 = 10</code> mais <code>'5'+'5' = '55'</code></p>
<p>Si l’un des arguments est une chaîne, l’autre sera converti, par exemple: <code>5 + '5' = '55'</code></p>
<p>C’est ce que l’on vient de faire lorsque nous avons concaténé <code>(cat_image.offsetWidth + 30.0) + 'px'</code>.</p>
<div id="autres-listeners-qui-peuvent-savérer-utiles" class="callout panel panel-info">
<div class="panel-heading">
<h2 id="autres-listeners-qui-peuvent-savérer-utiles" class="callout panel panel-info"><span class="glyphicon glyphicon-pushpin"></span>Autres listeners qui peuvent s’avérer utiles</h2>
</div>
<div class="panel-body">
<ul>
<li>dblclick - Double clic</li>
<li>contextmenu - Clic-droit</li>
<li>mouseover - Le pointeur de la souris passe sur un élément</li>
<li>keypress - Appui d’une touche du clavier</li>
</ul>
</div>
</div>
<div id="un-peu-de-sport-pour-notre-chat" class="challenge panel panel-success">
<div class="panel-heading">
<h2 id="un-peu-de-sport-pour-notre-chat" class="challenge panel panel-success"><span class="glyphicon glyphicon-pencil"></span>Un peu de sport pour notre chat</h2>
</div>
<div class="panel-body">
<p>Créer un second bouton “faire du sport” qui fasse maigrir le chat.</p>
</div>
</div>
<p>À la fin de cette leçon, votre page devrait ressembler à ceci:</p>
<iframe src="http://isakiko.github.io/D3-visualising-data/code/meow.html" width="1000" height="250">
</iframe>
        </div>
      </div>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
        <a class="label swc-blue-bg" href="https://github.com/swcarpentry/lesson-template">Source</a>
        <a class="label swc-blue-bg" href="mailto:admin@software-carpentry.org">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="http://software-carpentry.org/v5/js/jquery-1.9.1.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
  </body>
</html>
