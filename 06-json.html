<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>Software Carpentry: JSON</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="alternate" type="application/rss+xml" title="Software Carpentry Blog" href="http://software-carpentry.org/feed.xml"/>
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="http://software-carpentry.org" title="Software Carpentry">
          <img alt="Software Carpentry banner" src="img/software-carpentry-banner.png" />
        </a>
      </div>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
          <h1 class="title">JSON</h1>
          <h2 class="subtitle">Tout n’est que chaînes!</h2>
<div id="objectifs-de-la-leçon" class="objectives panel panel-warning">
<div class="panel-heading">
<h2 id="objectifs-de-la-leçon" class="objectives panel panel-warning"><span class="glyphicon glyphicon-certificate"></span>Objectifs de la leçon</h2>
</div>
<div class="panel-body">
<ul>
<li>Comprendre les types de données de Javascript</li>
<li>Convertir des données Javascript au format JSON</li>
<li>Convertir des données JSON au format Javascript</li>
</ul>
</div>
</div>
<p>Le but de ce cours est de visualiser des données. Nous n’avons pas encore commencé à nous occuper de données particulières, sans même parler d’importants fichiers de données. Dans cette leçon nous allons voir les types de données de base utilisés par Javascript et évoquer divers moyens pratiques pour les convertir dans un fichier texte, afin de pouvoir les enregistrer.</p>
<p>Il y a deux types de conteneurs en Javascript: les listes ou tableaux (notation <code>[]</code>) et les objets (notation <code>{}</code>).</p>
<p>Pour créer un conteneur, il faut le déclarer d’abord avec le mot-clé <code>var</code>, que nous avons déjà rencontré.</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">var</span> liste_de_nombres <span class="op">=</span> []<span class="op">;</span></code></pre></div>
<p>crée un tableau. Pour l'instant, celui-ci est vide.</p>
<p>On peut maintenant ajouter des éléments dans ce tableau, ou alors le faire dès la création du tableau, sous cette forme:</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">var</span> liste_de_nombres <span class="op">=</span> [<span class="dv">30</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">5</span>]<span class="op">;</span></code></pre></div>
<p>Utilisons la console du navigateur pour visualiser les valeurs de cet objet:</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="va">console</span>.<span class="at">log</span>(liste_de_nombres)<span class="op">;</span></code></pre></div>
<p>On peut aussi aller chercher le _x_ème élément du tableau. Comme on compte à partir de 0, le troisième champ a l’index '2'.</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="va">console</span>.<span class="at">log</span>(liste_de_nombres[<span class="dv">2</span>])<span class="op">;</span></code></pre></div>
<p><code>liste_de_nombres</code> est une liste de 3 nombres.</p>
<p>À noter, une chaîne peut être vue comme une liste de lettres:</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">var</span> text <span class="op">=</span> <span class="st">&#39;I love cats.&#39;</span><span class="op">;</span></code></pre></div>
<p><code>console.log(text[2])</code> renverra <code>l</code>.</p>
<p>Contrairement aux listes qui vous permettent d’accéder aux éléments par leur index, les objets Javascript permettent d’accéder aux propriétés (ou attributs) en utilisant des noms. Ce mécanisme permet de créer quelque chose du genre:</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">var</span> cat_object <span class="op">=</span> <span class="op">{</span>
    <span class="dt">weight </span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span>
    <span class="dt">past_weight_values </span><span class="op">:</span> [<span class="fl">4.5</span><span class="op">,</span> <span class="fl">5.1</span><span class="op">,</span> <span class="fl">4.9</span>]<span class="op">,</span>
    <span class="dt">name </span><span class="op">:</span> <span class="st">&#39;Princess Caroline&#39;</span>
<span class="op">};</span></code></pre></div>
<div id="créer-de-nouveaux-attributs" class="challenge panel panel-success">
<div class="panel-heading">
<h2 id="créer-de-nouveaux-attributs" class="challenge panel panel-success"><span class="glyphicon glyphicon-pencil"></span>Créer de nouveaux attributs</h2>
</div>
<div class="panel-body">
<p>On peut ajouter un attribut avec la syntaxe à point <code>cat_object . attributename = ...</code>, Créer un nouvel attribut <code>height</code> et affectez-lui une valeur!</p>
</div>
</div>
<p>On voudra ensuite prendre une liste d’objets ; on pourra alors extraire un objet de cette liste en demandant son index. Dans notre cas, on pourrait avoir un de multiple chats, sous forme d’une liste d’objets où chaque objet représenterait un chat. Pour ajouter une valeur (ou un objet) dans une liste, on utilise la fonction <code>push</code>:</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">var</span> cat_list <span class="op">=</span> [cat_object]<span class="op">;</span> <span class="co">// la liste contient notre premier chat</span>
<span class="va">cat_list</span>.<span class="at">push</span>(<span class="op">{</span><span class="dt">weight </span><span class="op">:</span> <span class="dv">6</span> <span class="op">,</span> <span class="dt">past_weight_values </span><span class="op">:</span> [<span class="fl">5.9</span><span class="op">,</span> <span class="fl">5.3</span><span class="op">,</span> <span class="fl">6.1</span>]<span class="op">,</span> <span class="dt">name </span><span class="op">:</span> <span class="st">&#39;Snowball&#39;</span><span class="op">}</span>)<span class="op">;</span> <span class="co">// ajout du second chat</span></code></pre></div>
<p>Ce processus s’appelle 'nesting'.</p>
<div id="nesting" class="challenge panel panel-success">
<div class="panel-heading">
<h1 id="nesting" class="challenge panel panel-success"><span class="glyphicon glyphicon-pencil"></span>Nesting</h1>
</div>
<div class="panel-body">
<ol style="list-style-type: decimal">
<li>Ajouter un troisième chat dans la liste, sans préciser son nom ni son poids.</li>
<li>Les animaux doivent-ils tous avoir les mêmes attributs?</li>
<li>Utiliser la console pour lire les valeur de vos objets.</li>
</ol>
</div>
</div>
<div id="attention-aux-références" class="challenge panel panel-success">
<div class="panel-heading">
<h2 id="attention-aux-références" class="challenge panel panel-success"><span class="glyphicon glyphicon-pencil"></span>Attention aux références</h2>
</div>
<div class="panel-body">
<p>Que se passe-t-il si l’on référence deux fois de suite le même chat dans la liste?</p>
<p>Réinitialisons la liste:</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">var</span> cat_list2 <span class="op">=</span> [cat_object<span class="op">,</span> cat_object]<span class="op">;</span> </code></pre></div>
<ol style="list-style-type: decimal">
<li>Changeons le nom du premier chat <code>cat_list2[0]</code>. Regardons à nouveau la liste (<code>cat_list2</code>). Que s’est-il passé?</li>
<li>Regardons l’objet initial cat_object. Que se passe-t-il?</li>
</ol>
</div>
</div>
<p>En Javascript, il existe un espace des noms et un espace des objets. L’espace des noms contient les références des variables, tandis que l’espace des objets contient le contenu réel. Ainsi dans notre liste, plusieurs références (le nom du chat0, le nom du chat1), pointent vers le même objet. C’est cet objet que nous avons changé, et toutes les références continuent de pointer vers cet objet.</p>
<p><img src="img/namespace.png" alt=« Espace de noms et espaces des objets" width="500" /></p>
<p>Pour créer une nouvelle liste à partir d’une liste existante, une bonne méthode est d’utiliser la méthode <code>map()</code>, qui va appliquer une fonction à l’ensemble des éléments de la liste initiale, et renvoyer la liste des résultats.</p>
<p>Voici par exemple comment produire une liste de chiens à partir de notre liste de chats. On conserve les mêmes noms, mais en leur rajoutant le mot « Doggie ».</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript">dog_list <span class="op">=</span> <span class="va">cat_list</span>.<span class="at">map</span>(<span class="kw">function</span>(cat) <span class="op">{</span>
    <span class="cf">return</span> <span class="op">{</span>
        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Doggie &quot;</span><span class="op">+</span> <span class="va">cat</span>.<span class="at">name</span>
    <span class="op">};</span>
<span class="op">}</span>)<span class="op">;</span></code></pre></div>
<p>La fonction de callback appelée par la méthode <code>.map()</code> va s’appliquer à tous les éléments de la liste, temporairement nommés <code>cat</code>.</p>
<div id="quel-est-le-poids-des-chiens" class="challenge panel panel-success">
<div class="panel-heading">
<h1 id="quel-est-le-poids-des-chiens" class="challenge panel panel-success"><span class="glyphicon glyphicon-pencil"></span>Quel est le poids des chiens?</h1>
</div>
<div class="panel-body">
<p>Supposns que nos chiens pèsent chacun le double de leur ancètre chat. Créez la nouvelle liste de cette manière.</p>
</div>
</div>
<p>Lorsque nous allons créer nos données pour le graphique, ce sont des données strucutrées de cette manière qu’il nous faudra.</p>
<p>Mais pour enregistrer ces données, il faut les mettre dans un format texte. C’est la fonction <code>JSON.stringify()</code> qui se charge de ce travail.</p>
<p>Pour convertir notre liste de chats en un format JSON, onous allons saisir la commande:</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">var</span> cat_json <span class="op">=</span> <span class="va">JSON</span>.<span class="at">stringify</span>(cat_list)<span class="op">;</span></code></pre></div>
<p>La chaîne de caractères résultante est à enregistrer dans un fichier <code>.json</code>, que l'on pourra lire plus tard. Bien sûr à l'intérieur du navigateur il n'est pas permis de créer des fichiers, car le danger serait alors de favoriser la création de virus.</p>
<p>Mais on peut regarder notre chaîne de caractères avec la fonction <code>alert()</code>:</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="at">alert</span>(cat_json)<span class="op">;</span></code></pre></div>
<p>Le résultat ressemble à ceci:</p>
<pre class="out"><code>[{&quot;weight&quot;:5,&quot;past_weight_values&quot;:[4.5,5.2,4.9],&quot;name&quot;:&quot;Princess Caroline&quot;},{&quot;weight&quot;:6,&quot;past_weight_values&quot;:[5.9,5.3,6.1],&quot;name&quot;:&quot;Snowball&quot;}]</code></pre>
<p>On peut maintenant recopier cette chaîne et l’enresigtrer à la main dans un fichier <code>.json</code>.</p>
<div id="convertir-en-json" class="challenge panel panel-success">
<div class="panel-heading">
<h2 id="convertir-en-json" class="challenge panel panel-success"><span class="glyphicon glyphicon-pencil"></span>Convertir en JSON</h2>
</div>
<div class="panel-body">
<p>À l’inverse, les données sont parfois présentées dans des fichiers au format JSON, et on veut lire ces fichiers pour récupérer les données structurées dans le navigateur. Ce processus s’appelle « phraser » (parse), et la fonction Javascript qui s’en occupe est <code>JSON.parse()</code> Convertissez la variable <code>cat_json</code> en objet Javascript.</p>
</div>
</div>
<p>Nous sommes maintenant arrivés au point où il va falloir ouvrir le fichier de données qui nous intéresse. Ouvrons donc dans un éditeur de texte le fichier 'nations.json'.</p>
<p>Voici un apeçu de ce fichier. Nous avons des données de 10 pays différents, qui décrivent le revenu par habitant, la population, l’espérance de vie, pour les années 1800 à 2009. Source: <a href="http://www.gapminder.org/data/">gapminder</a></p>
<pre class="out"><code>[
  {
    &quot;name&quot;: &quot;Angola&quot;,
    &quot;region&quot;: &quot;Sub-Saharan Africa&quot;,
    &quot;years&quot;: [
      1950,
      1951,
      1952,
      ...
    ],
    &quot;income&quot;: [
      3363.02,
      3440.9,
      3520.61,
      ...
    ],
    &quot;population&quot;: [
      4117617,
      4173095,
      4232095,
      ...
    ],
    &quot;lifeExpectancy&quot;: [
      29.22,
      29.42,
      29.81,
      ...
    ]
  },
  { ... }
]</code></pre>
        </div>
      </div>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
        <a class="label swc-blue-bg" href="https://github.com/swcarpentry/lesson-template">Source</a>
        <a class="label swc-blue-bg" href="mailto:admin@software-carpentry.org">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="http://software-carpentry.org/v5/js/jquery-1.9.1.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
  </body>
</html>
